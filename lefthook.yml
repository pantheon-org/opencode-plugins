# Lefthook configuration for opencode-plugins
# Leverages Nx to run tasks on affected packages with Biome
# For more information: https://lefthook.dev/configuration/

pre-commit:
  parallel: true
  commands:
    # Biome check (lint + format) on affected packages
    biome:
      run: bunx nx affected --target=check --base=HEAD~1 --head=HEAD --parallel=3

    # Validate JSDoc on affected packages
    jsdoc:
      run: bunx nx affected --target=validate:jsdoc --base=HEAD~1 --head=HEAD --parallel=3

    # Type-check affected packages using Nx
    type-check:
      run: bunx nx affected --target=type-check --base=HEAD~1 --head=HEAD --parallel=3

    # Lint markdown files
    markdown-lint:
      glob: "*.md"
      run: bunx markdownlint-cli2 {staged_files}

pre-push:
  commands:
    # Biome check on all affected packages
    check:
      run: bunx nx affected --target=check --base=origin/main --head=HEAD --parallel=3

    # Validate JSDoc on all affected packages
    jsdoc:
      run: bunx nx affected --target=validate:jsdoc --base=origin/main --head=HEAD --parallel=3

    # Validate markdown on all affected packages
    markdown:
      run: bunx nx affected --target=validate:markdown --base=origin/main --head=HEAD --parallel=3

    # Type-check all affected packages
    type-check:
      run: bunx affected --target=type-check --base=origin/main --head=HEAD --parallel=3

    # Run tests on affected packages
    test:
      run: bunx nx affected --target=test --base=origin/main --head=HEAD --parallel=3

    # Build affected packages
    build:
      run: bunx nx affected --target=build --base=origin/main --head=HEAD --parallel=3

# Skip hooks configuration
# To skip a hook, run: LEFTHOOK=0 git commit
# To skip specific commands: LEFTHOOK_EXCLUDE=biome git commit

output:
  - execution
  - execution_info
